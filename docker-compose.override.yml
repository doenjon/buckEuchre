# ==============================================================================
# Buck Euchre - Local Development Overrides
# ==============================================================================
# 
# This file automatically overrides docker-compose.yml for local development.
# It is automatically loaded by docker-compose (no -f flag needed).
# 
# ⚠️  DO NOT COMMIT THIS FILE - Add to .gitignore
# 
# Key changes for dev:
# - HTTP only (no SSL/HTTPS)
# - Frontend uses Vite dev server (port 5173)
# - Nginx uses dev config without SSL redirects
# 
# ==============================================================================

version: '3.8'

services:
  # Backend - Dev mode with hot reload
  backend:
    environment:
      NODE_ENV: development
    volumes:
      - ./backend/src:/app/backend/src:ro
      - ./shared/src:/app/shared/src:ro
      - ./backend/prisma:/app/backend/prisma:ro
    command: >
      sh -c "cd /app/backend && 
             npx prisma migrate deploy && 
             npx tsx watch src/index.ts"

  # Frontend - Use Vite dev server with HMR
  frontend:
    build:
      context: .
      dockerfile: frontend/Dockerfile
      target: builder
    command: npm run dev -- --host
    working_dir: /app
    ports:
      - "5173:5173"
    volumes:
      - ./frontend/src:/app/src:rw
      - ./frontend/index.html:/app/index.html:rw
      - ./frontend/public:/app/public:ro
      - ./frontend/vite.config.ts:/app/vite.config.ts:ro
      - ./frontend/tailwind.config.js:/app/tailwind.config.js:ro
      - ./frontend/postcss.config.js:/app/postcss.config.js:ro
      - ./frontend/package.json:/app/package.json:ro
      - ./shared:/shared:rw
      - /app/node_modules
      - /app/dist
      - /shared/node_modules
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:5173/"]

  # Nginx - HTTP only, no SSL for dev
  nginx:
    ports:
      - "80:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/conf.d/buckeuchre.conf:/etc/nginx/conf.d/buckeuchre.conf:ro

